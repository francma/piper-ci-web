{% extends "_layout.html" %}
{% block title %}Job #{{ job.id }}{% endblock %}
{% block body %}
<header>
{% include 'breadcrumbs.html' %}
</header>
<header>
    <h5>Detail</h5>
</header>
<pre class="code" data-lang="json"><code>{{ job | pretty_json }}</code></pre>
<header>
    <h5>Log</h5>
</header>
<pre class="code-terminal" data-lang="shell"><code id="log"></code></pre>
{% endblock %}
{% block script %}
<script src="{{ url_for('static', filename='ansi_up.js') }}" type="text/javascript"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var offset = 0;
    var ansi_up = new AnsiUp;
    var code = document.getElementById('log');
    var output = "";

    var fn = function() {
        fetch('/logs/{{ job.id }}?offset=' + offset).then(function(response) {
            return response.text();
        }).then(function(text) {
            offset += text.length;
            code.innerHTML += ansi_up.ansi_to_html(text);
            setTimeout(fn, 1000);
        });
    }

    fn();
});

</script>
{% endblock %}